{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="{% static 'css/article.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="menu">
        <div class="menu-bar">
            <a href="{% url 'home' %}">Home</a>
        </div>
        <div class="menu-bar">
            <a href=""> About </a>
        </div>
        <div class="menu-bar">
            <a href="">Portfolio</a>
        </div>
        <div class="menu-bar">
            <a href="{% url 'contact' %}"> Contact </a>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Category</button>
            <div class="dropdown-content">
                {% for i in category %}
                    <a href="{% url 'category' i.id %}">{{ i.name }}</a>
                {% endfor %}
            </div>
          </div>
        {% if user.is_authenticated %}
        <div class="menu-bar">
            <a href="{% url 'logout' %}"> Logout </a>
        </div>
        <div class="dropdown">
            <button class="dropbtn">Profile</button>
            <div class="dropdown-content">
                {% if user_profile %}
                    <a href="{% url 'create-profile' user.id %}">Create</a>
                {% else %}
                    <a href="{% url 'edit-profile' profile.id %}">Update</a>
                    <a href="{% url 'delete-profile' profile.id %}">Delete</a>
                    <a href="{% url 'profile' profile.id %}">View</a>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="menu-bar">
            <a href="{% url 'register' %}"> Register </a>
        </div>
        <div class="menu-bar">
            <a href="{% url 'login' %}"> Login </a>
        </div>
        {% endif %}
        <div class="menu-bar1">
            {% if user.is_authenticated %}
                <a href=""> {{ user.username }} </a>
            {% else %}
                <a href=""> {{ user_identifier }} </a>
            {% endif %}
        </div>
    </div>

    <div class="body1">
        <h1> {{ post.title }} </h1>
        {% if post.image1 %}
            <img src="{{ post.image1.url }}" alt="">
            <br>
            <br>
            <br>
        {% else %}
            <img src="{% static 'img/birinchi oyna orqa fon.png' %}" alt="">
            <br>
            <br>
            <br>
        {% endif %}
        {% if post.content1 %}
            <p> {{ post.content1|safe }} </p>
            <br>
            <br>
            <br>
        {% endif %}
        {% if post.image2 %}
            <img src="{{ post.image2.url }}" alt="">
            <br>
            <br>
            <br>
        {% endif %}
        {% if post.content2 %}
            <p> {{ post.content2|safe }} </p>
            <br>
            <br>
            <br>
        {% endif %}
        <br>
        {% if post.image3 %}
            <img src="{{ post.image3.url }}" alt="">
            <br>
            <br>
            <br>
        {% endif %}
        {% if post.content3 %}
            <p> {{ post.content3|safe }} </p>
            <br>
            <br>
            <br>
        {% endif %}
        <br>
        {% if post.image4 %}
            <img src="{{ post.image4.url }}" alt="">
            <br>
            <br>
            <br>
        {% endif %}
        {% if post.content4 %}
            <p> {{ post.content4|safe }} </p>
            <br>
            <br>
            <br>
        {% endif %}
        <br>
        <div class="rating">
            <h1>
                Otsenka - {{ rat }} |
            </h1>
            <h1>
                Obshayay otsenka - {{ ball }} |
            </h1>
            <h1>
                Kolichestvo lyudey - {{ count }}
            </h1>
            <p>
                {{ post.created_at }}
            </p>
        </div>
        <div class="starbax">
            {% if user.is_authenticated %}
                {% for i in rating%}
                    <a href="{% url 'add_star' post.id i %}"> <span class="fa fa-star checked"></span> </a>
                {% endfor %}
                {% for i in unrating %}
                    <a href="{% url 'add_star' post.id i %}"> <span class="fa fa-star"></span> </a>
                {% endfor %}
            {% else %}
                {% for i in rating %}
                    <a href="{% url 'login' %}"> <span class="fa fa-star checked"></span> </a>
                {% endfor %}
                {% for i in unrating %}
                    <a href="{% url 'login' %}"> <span class="fa fa-star"></span> </a>
                {% endfor %}
            {% endif %}
            <div class="liked">
                {% if user.is_authenticated %}
                    <a href="#" id="likeButton" data-post-id="{{ post.id }}">
                        {% if liked %}
                            <img src="{% static 'img/heart.png' %}" alt="" id="likeImage">
                        {% else %}
                            <img src="{% static 'img/love.png' %}" alt="" id="likeImage">
                        {% endif %}
                    </a>
                {% else %}
                    <a href="{% url 'login' %}">
                        <img src="{% static 'img/love.png' %}" alt="">
                    </a>
                {% endif %}
            </div>
            <div class="liked1" >
                <p id="likesCount"> {{ post.total_likes }} </p>
            </div>

        </div>

        <br>
        <br>
        <br>
        <br>

        <div class="comment">
            <h1> Comment </h1>
            {% for i in comment %}
                <br>
                <p> author - {{i.username}} </p>
                <p> {{i.comment | safe}} </p>
                <p> {{i.date_ad | date:"b. d Y, G:i"}} </p>
                <br>
            {% endfor %}
        </div>
        <br>
        <br>
        <div class="add-comment"> 
            {% if user.is_authenticated %}
                <h2>
                    <a href="{% url 'comment-username' post.id user.id %}"> 
                        Add Comment 
                    </a>
                </h2>
            {% else %}
                <h2>
                    <a href="{% url 'comment' post.id %}"> 
                        Add Comment 
                    </a>
                </h2>
            {% endif %}                
            <br>
            <br>
            <br>    
        </div>
    </div>
    <style>
        .checked{
            color: yellow;
        }
    </style>
 
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script> 
        $(document).ready(function() {
            $('#likeButton').on('click', function(e) {
                e.preventDefault();
        
                var post_id = $(this).data('post-id');
                $.ajax({
                    url: '/like/' + post_id + '/',
                    method: 'GET',
                    success: function(data) {
                        $('#likesCount').text(data.likes_count);
        
                        // Проверяем переменную liked и обновляем изображение лайка соответственно
                        if (data.liked) {
                            $('#likeImage').attr('src', '{% static "img/heart.png" %}');
                        } else {
                            $('#likeImage').attr('src', '{% static "img/love.png" %}');
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
